---
title: 'Section C: Distribution of Teacher Resources in Washington'
author: "Pooya Almasi"
date: "`r format(Sys.Date(), format = '%B %d, %Y')`"
output: 
  html_document:
        fig_width: 12
        toc_float: true
        toc: true
knit: (function(input, encoding) rmarkdown::render(input, output_file = "index.html"))
---

```{r include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      comment = NA, 
                      cache = TRUE,
                      warning = FALSE,
                      message = FALSE, 
                      cache.lazy = FALSE,
                      fig.align = "center"
                      )
```


```{r data, include=FALSE}

library(tidyverse)
library(googledrive)
library(haven)


id_s275_2015_2019 <- drive_get(as_id("https://drive.google.com/file/d/1wV5hiz5lJvHC-FljTl4Np1UynNoLTP88/view?usp=sharing"))
id_s275_2020<- drive_get(as_id("https://drive.google.com/file/d/1weEr_ZuFLyKYxPE_raj_6pWnov-2yJd2/view?usp=sharing"))
id_f196 <- drive_get(as_id("https://drive.google.com/file/d/1sGIIj3hplOHq7qPL7S7YTmQByzuCcHVU/view?usp=sharing"))
id_demos <- drive_get(as_id("https://drive.google.com/file/d/1C2Kt_DsoYlz2eB-8z9SB97d5-G2jmYKc/view?usp=sharing"))
id_cwi_2015_2020 <- drive_get(as_id("https://drive.google.com/file/d/1--RKu4geGLO9sOxag7pyJtkw40ZYYkeI/view?usp=sharing"))

df_s275_2015_2019 <- id_s275_2015_2019 %>%
  drive_read_raw() %>%
  read_dta()

df_s275_2020 <- id_s275_2020 %>%
  drive_read_raw() %>%
  read_dta()

df_f196 <- id_f196 %>%
  drive_read_raw() %>%
  read_dta()

df_demos <- id_demos %>%
  drive_read_raw() %>%
  read_dta()

df_cwi_2019 <- id_cwi_2015_2020 %>%
  drive_read_raw() %>%
  read_csv() %>% 
  filter(year == 2019) %>% 
  mutate(dist_id = as.numeric(dist_id))

df_cwi_2020 <- id_cwi_2015_2020 %>%
  drive_read_raw() %>%
  read_csv() %>% 
  filter(year == 2020) %>% 
  mutate(dist_id = as.numeric(dist_id))

df_s275_raw <- bind_rows(df_s275_2015_2019, df_s275_2020)

df_s275_raw <- df_s275_raw %>%
  mutate(cou_s = str_pad(as.character(cou), 2, side="left", pad="0"),
         dis_s = str_pad(as.character(dis), 3, side="left", pad="0"),
         coudis_s=paste(cou_s, dis_s, sep=""))

df_s275_raw <- full_join(df_s275_raw, df_f196, by=c("coudis_s"="coudis", "schyear"="schyear"))

df_s275_raw <- full_join(df_s275_raw, df_demos, by=c("coudis_s"="coudis_s", "schyear"="schyr"))



df_s275 <- df_s275_raw %>%
  filter(droot == 31 | droot == 32 | droot == 33 | droot == 34) %>%
  filter(certfte > 0.5) %>% 
  mutate(lname = str_to_lower(str_trim(LastName)),
         fname = str_to_lower(str_trim(FirstName)),
         mname = str_to_lower(str_trim(MiddleName))) %>%
  distinct_at(vars(schyear, lname, fname, mname, certfte, exp, othersal, 
                   tfinsal, certbase, clasbase, cert, coudis_s), 
              .keep_all = TRUE) 

```


C.1 Regionalization Factor Bar Graph separately for 2018-19; 2019-20 (difference in regionalization factor levels between years): 
       G1=1; men=average poverty rate; women=average share of students of color
```{r C1}

df_s275 %>% 
  filter(SchoolYear == "2018-2019" & !is.na(rfactor_cis_2019)) %>% 
  mutate(rfactor = as.character(rfactor_cis_2019)) %>% 
  group_by(rfactor) %>% 
  summarize(pctstu_nonwhite = mean(1 - dis_pctstu_white - dis_pctstu_asian, na.rm = TRUE),
            pctstu_frpl = mean(dis_pctstu_frl, na.rm = TRUE)) %>% 
  pivot_longer(c(pctstu_nonwhite, pctstu_frpl), names_to = "var", values_to = "val") %>% 
  ggplot(aes(x = rfactor, y = val, fill = var)) +
  geom_col(position = "dodge", width = 0.7) + 
  geom_text(aes(label = round(val*100, digits = 1)), position = position_dodge(width = 0.7), vjust = -0.25, size = 3.5) +
  scale_fill_discrete(name = "", 
                      breaks = c("pctstu_nonwhite", "pctstu_frpl"),
                      labels = c("% non-white \n(excludes asian)", "% receiving FRPL")) + 
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), limits = c(0, 0.7)) +
  labs(x = "Regionalization Factor",
       y = "",
       title = "Regionalization factor by share of non-white students and FRPL for AY 2018-2019")


df_s275 %>% 
  filter(SchoolYear == "2018-2019" & !is.na(rfactor_cis_2019)) %>% 
  mutate(rfactor = as.character(rfactor_cis_2019)) %>% 
  group_by(rfactor) %>% 
  summarize(pctstu_nonwhite = mean(1 - dis_pctstu_white - dis_pctstu_asian, na.rm = TRUE),
            pctstu_hispanic = mean(dis_pctstu_hispanic, na.rm = TRUE),
            pctstu_black = mean(dis_pctstu_black, na.rm = TRUE),
            pctstu_asian = mean(dis_pctstu_asian, na.rm = TRUE),
            pctstu_white = mean(dis_pctstu_white, na.rm = TRUE)) %>% 
  pivot_longer(c(pctstu_nonwhite, pctstu_hispanic, pctstu_black, pctstu_asian, pctstu_white), names_to = "var", values_to = "val") %>% 
  ggplot(aes(x = var, y = val, fill = rfactor)) +
  geom_col(position = "dodge", width = 0.8) + 
  geom_text(aes(label = round(val*100, digits = 1)), position = position_dodge(width = 0.8), vjust = -0.25, size = 2) +
  scale_x_discrete(name = "",
                   limits = c("pctstu_nonwhite", "pctstu_hispanic", "pctstu_black", "pctstu_asian", "pctstu_white"),
                   labels = c("% non-white \n(excludes asian)", "% hispanic", "% black", "% asian", "% white")) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1), limits = c(0, 0.65)) +
  labs(fill = "Regionalization Factor",
       x = "",
       y = "",
       title = "Share of students of color by Regionalization factor for AY 2018-2019")


# 
# 
# df_s275 %>% 
#   filter(SchoolYear == "2019-2020" & !is.na(leap_rfactor_cis_2020)) %>% 
#   mutate(rfactor = as.character(leap_rfactor_cis_2020)) %>% 
#   group_by(rfactor) %>% 
#   summarize(pctstu_nonwhite = mean(1 - dis_pctstu_white - dis_pctstu_asian, na.rm = TRUE),
#             pctstu_frpl = mean(dis_pctstu_frl, na.rm = TRUE)) %>% 
#   pivot_longer(c(pctstu_nonwhite, pctstu_frpl), names_to = "var", values_to = "val") %>% 
#   ggplot(aes(x = rfactor, y = val, fill = var)) +
#   geom_col(position = "dodge", width = 0.7) + 
#   geom_text(aes(label = round(val*100, digits = 1)), position = position_dodge(width = 0.7), vjust = -0.25, size = 3.5) +
#   scale_fill_discrete(name = "", 
#                       breaks = c("pctstu_nonwhite", "pctstu_frpl"),
#                       labels = c("% non-white \n(excludes asian)", "% receiving FRPL")) + 
#   # scale_y_continuous(labels = scales::percent_format(accuracy = 1), limits = c(0, 0.7)) +
#   labs(x = "Regionalization Factor",
#        y = "",
#        title = "Regionalization factor by share of non-white students and FRPL for AY 2019-2020")


```

C.2. Regionalization correlated with teacher salary adjusted local non-teacher wages (which is in the cost index database). Use either bar graph as above, or use the correlation scatter plot similar as below (regionalization factor will be in the x-axis, while average teacher salary for each district in 2019-20 [adjusted for local non-teacher wages] will be in the y-axis). 
```{r C2}


temp <- df_s275 %>% 
  filter(SchoolYear == "2018-2019" & !is.na(rfactor_cis_2019)) %>% 
  group_by(codist) %>% 
  mutate(avg_dist_salary = mean(tfinsal, na.rm = TRUE),
         rfactor = as.numeric(as.character(rfactor_cis_2019))) %>%
  slice_head() %>% 
  ungroup() %>% 
  group_by(rfactor) %>% 
  summarize(max_sal_distname = dis_name[which.max(avg_dist_salary)],
            min_sal_distname = dis_name[which.min(avg_dist_salary)])

outlier_disnames <- c(as.vector(as.matrix(temp[, c("max_sal_distname", "min_sal_distname")])),
                      "Seattle Public Schools", "Lake Washington School District",
                      "Spokane School District", "Tacoma School District")
rm(temp)



## with FINAL salary
df_s275 %>% 
  filter(SchoolYear == "2018-2019" & !is.na(rfactor_cis_2019)) %>% 
  group_by(codist) %>% 
  # mutate(avg_dist_salary = mean(staterev_cissal_r19_2019_18d, na.rm = TRUE)) %>% 
  # mutate(avg_dist_salary = mean(staterev_tchsal_r19_2019_18d, na.rm = TRUE)) %>%
  mutate(avg_dist_salary = mean(tfinsal, na.rm = TRUE),
         rfactor = as.numeric(as.character(rfactor_cis_2019)),
         dist_enroll = mean(dis_enroll.y, na.rm = TRUE)) %>%
  slice_head() %>% 
  ungroup() %>% 
  ggplot(aes(x = rfactor, y = avg_dist_salary)) + 
  geom_text(aes(label = if_else(dis_name %in% outlier_disnames, as.character(dis_name), '')),
            hjust=0, vjust=0, size = 3, position = position_jitter(width = 0.01, height = 0, seed = 99)) +
  geom_point(position = position_jitter(width = 0.01, height = 0, seed = 99)) +
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  scale_x_continuous("Regionalization Factor", limits = c(.99, 1.28), breaks = c(1.00, 1.06, 1.12, 1.18, 1.24)) +
  scale_y_continuous("Average District Teacher Salary", limits = c(30000, 100000), labels=scales::dollar_format()) +
  theme_classic() +
  theme(panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank()) +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(title = "Scatterplot of (unadjusted) teacher (final) salary and regionalization factor \nfor school districts during AY 2018-2019",
       caption = "Fitted line is weighted by district's enrollment size.")


df_s275 %>% 
  filter(SchoolYear == "2018-2019" & !is.na(rfactor_cis_2019)) %>% 
  left_join(df_cwi_2019, by = c("codist" = "dist_id")) %>% 
  group_by(codist) %>% 
  mutate(avg_dist_salary = mean(tfinsal, na.rm = TRUE)/cwi,
         rfactor = as.numeric(as.character(rfactor_cis_2019)),
         dist_enroll = mean(dis_enroll.y, na.rm = TRUE)) %>%
  slice_head() %>% 
  ungroup() %>% 
  ggplot(aes(x = rfactor, y = avg_dist_salary)) + 
  geom_text(aes(label = if_else(dis_name %in% outlier_disnames, as.character(dis_name), '')),
            hjust=0, vjust=0, size = 3, position = position_jitter(width = 0.01, height = 0, seed = 99)) +
  geom_point(position = position_jitter(width = 0.01, height = 0, seed = 99)) +
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  scale_x_continuous("Regionalization Factor", limits = c(.99, 1.28), breaks = c(1.00, 1.06, 1.12, 1.18, 1.24)) +
  scale_y_continuous("Average District Teacher Salary", limits = c(30000, 100000), labels=scales::dollar_format()) +
  theme_classic() +
  theme(panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank()) +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(title = "Scatterplot of (adjusted) teacher (final) salary and regionalization factor \nfor school districts during AY 2018-2019",
       subtitle = "normalized by cost of wage index for each school district",
       caption = "Fitted line is weighted by district's enrollment size.")


df_s275 %>% 
  filter(SchoolYear == "2019-2020" & !is.na(leap_rfactor_cis_2020)) %>% 
  group_by(codist) %>% 
  mutate(avg_dist_salary = mean(tfinsal, na.rm = TRUE),
         rfactor = as.character(leap_rfactor_cis_2020),
         dist_enroll = mean(dis_enroll.y, na.rm = TRUE)) %>%
  slice_head() %>% 
  ungroup() %>% 
  ggplot(aes(x = rfactor, y = avg_dist_salary)) + 
  # geom_text(aes(label = if_else(dis_name %in% outlier_disnames, as.character(dis_name), '')),
  #           hjust=0, vjust=0, size = 3, position = position_jitter(width = 0.01, height = 0, seed = 99)) +
  geom_point(position = position_jitter(width = 0.08, height = 0, seed = 99)) +
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  # scale_x_continuous("Regionalization Factor", limits = c(.99, 1.28), breaks = c(1.00, 1,04, 1.06, 1,1, 1.12,
  #                                                                                1.16, 1.18, 1.22, 1.24, 1.28)) +
  scale_x_discrete("Regionalization Factor", breaks = c(1.00, 1.04, 1.06, 1.1, 1.12,
                                                        1.16, 1.18, 1.22, 1.24, 1.28)) +
  scale_y_continuous("Average District Teacher Salary", limits = c(30000, 120000), labels=scales::dollar_format()) +
  theme_classic() +
  theme(panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank()) +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(title = "Scatterplot of (unadjusted) teacher (final) salary and regionalization factor \nfor school districts during AY 2019-2020",
       caption = "Fitted line is weighted by district's enrollment size.")

df_s275 %>% 
  filter(SchoolYear == "2019-2020" & !is.na(leap_rfactor_cis_2020)) %>%
  left_join(df_cwi_2020, by = c("codist" = "dist_id")) %>% 
  group_by(codist) %>% 
  mutate(avg_dist_salary = mean(tfinsal, na.rm = TRUE)/cwi_2020_extrapolated,
         rfactor = as.character(leap_rfactor_cis_2020)) %>%
  slice_head() %>% 
  ungroup() %>% 
  ggplot(aes(x = rfactor, y = avg_dist_salary)) + 
  # geom_text(aes(label = if_else(dis_name %in% outlier_disnames, as.character(dis_name), '')),
  #           hjust=0, vjust=0, size = 3, position = position_jitter(width = 0.01, height = 0, seed = 99)) +
  geom_point(position = position_jitter(width = 0.08, height = 0, seed = 99)) +
  # scale_x_continuous("Regionalization Factor", limits = c(.99, 1.28), breaks = c(1.00, 1.04, 1.06, 1.1, 1.12,
  #                                                                                1.16, 1.18, 1.22, 1.24, 1.28)) +
  scale_x_discrete("Regionalization Factor", breaks = c(1.00, 1.04, 1.06, 1.1, 1.12,
                                                        1.16, 1.18, 1.22, 1.24, 1.28)) +
  scale_y_continuous("Average District Teacher Salary", limits = c(30000, 120000), labels=scales::dollar_format()) +
  theme_classic() +
  theme(panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank()) +
  labs(title = "Scatterplot of (adjusted) teacher (final) salary and regionalization factor \nfor school districts during AY 2019-2020",
       subtitle = "normalized by (extrapolated) cost of wage index for each school district")






## with BASE salary
df_s275 %>% 
  filter(SchoolYear == "2018-2019" & !is.na(rfactor_cis_2019)) %>% 
  group_by(codist) %>% 
  # mutate(avg_dist_salary = mean(staterev_cissal_r19_2019_18d, na.rm = TRUE)) %>% 
  # mutate(avg_dist_salary = mean(staterev_tchsal_r19_2019_18d, na.rm = TRUE)) %>%
  mutate(avg_dist_salary = mean(certbase, na.rm = TRUE),
         rfactor = as.numeric(as.character(rfactor_cis_2019)),
         dist_enroll = mean(dis_enroll.y, na.rm = TRUE)) %>%
  slice_head() %>% 
  ungroup() %>% 
  ggplot(aes(x = rfactor, y = avg_dist_salary)) + 
  geom_text(aes(label = if_else(dis_name %in% outlier_disnames, as.character(dis_name), '')),
            hjust=0, vjust=0, size = 3, position = position_jitter(width = 0.01, height = 0, seed = 99)) +
  geom_point(position = position_jitter(width = 0.01, height = 0, seed = 99)) +
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  scale_x_continuous("Regionalization Factor", limits = c(.99, 1.28), breaks = c(1.00, 1.06, 1.12, 1.18, 1.24)) +
  scale_y_continuous("Average District Teacher Salary", limits = c(30000, 100000), labels=scales::dollar_format()) +
  theme_classic() +
  theme(panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank()) +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(title = "Scatterplot of (unadjusted) teacher BASE salary and regionalization factor \nfor school districts during AY 2018-2019",
       caption = "Fitted line is weighted by district's enrollment size.")

df_s275 %>% 
  filter(SchoolYear == "2018-2019" & !is.na(rfactor_cis_2019)) %>% 
  left_join(df_cwi_2019, by = c("codist" = "dist_id")) %>% 
  group_by(codist) %>% 
  mutate(avg_dist_salary = mean(certbase, na.rm = TRUE)/cwi,
         rfactor = as.numeric(as.character(rfactor_cis_2019)),
         dist_enroll = mean(dis_enroll.y, na.rm = TRUE)) %>%
  slice_head() %>% 
  ungroup() %>% 
  ggplot(aes(x = rfactor, y = avg_dist_salary)) + 
  geom_text(aes(label = if_else(dis_name %in% outlier_disnames, as.character(dis_name), '')),
            hjust=0, vjust=0, size = 3, position = position_jitter(width = 0.01, height = 0, seed = 99)) +
  geom_point(position = position_jitter(width = 0.01, height = 0, seed = 99)) +
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  scale_x_continuous("Regionalization Factor", limits = c(.99, 1.28), breaks = c(1.00, 1.06, 1.12, 1.18, 1.24)) +
  scale_y_continuous("Average District Teacher Salary", limits = c(30000, 100000), labels=scales::dollar_format()) +
  theme_classic() +
  theme(panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank()) +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(title = "Scatterplot of (adjusted) teacher BASE salary and regionalization factor \nfor school districts during AY 2018-2019",
       subtitle = "normalized by cost of wage index for each school district",
       caption = "Fitted line is weighted by district's enrollment size.")



df_s275 %>% 
  filter(SchoolYear == "2019-2020" & !is.na(leap_rfactor_cis_2020)) %>% 
  group_by(codist) %>% 
  mutate(avg_dist_salary = mean(certbase, na.rm = TRUE),
         rfactor = as.character(leap_rfactor_cis_2020),
         dist_enroll = mean(dis_enroll.y, na.rm = TRUE)) %>%
  slice_head() %>% 
  ungroup() %>% 
  ggplot(aes(x = rfactor, y = avg_dist_salary)) + 
  # geom_text(aes(label = if_else(dis_name %in% outlier_disnames, as.character(dis_name), '')),
  #           hjust=0, vjust=0, size = 3, position = position_jitter(width = 0.01, height = 0, seed = 99)) +
  geom_point(position = position_jitter(width = 0.08, height = 0, seed = 99)) +
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  # scale_x_continuous("Regionalization Factor", limits = c(.99, 1.28), breaks = c(1.00, 1,04, 1.06, 1,1, 1.12,
  #                                                                                1.16, 1.18, 1.22, 1.24, 1.28)) +
  scale_x_discrete("Regionalization Factor", breaks = c(1.00, 1.04, 1.06, 1.1, 1.12,
                                                        1.16, 1.18, 1.22, 1.24, 1.28)) +
  scale_y_continuous("Average District Teacher Salary", limits = c(30000, 100000), labels=scales::dollar_format()) +
  theme_classic() +
  theme(panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank()) +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(title = "Scatterplot of (unadjusted) teacher BASE salary and regionalization factor \nfor school districts during AY 2019-2020",
       caption = "Fitted line is weighted by district's enrollment size.")

df_s275 %>% 
  filter(SchoolYear == "2019-2020" & !is.na(leap_rfactor_cis_2020)) %>%
  left_join(df_cwi_2020, by = c("codist" = "dist_id")) %>% 
  group_by(codist) %>% 
  mutate(avg_dist_salary = mean(certbase, na.rm = TRUE)/cwi_2020_extrapolated,
         rfactor = as.character(leap_rfactor_cis_2020)) %>%
  slice_head() %>% 
  ungroup() %>% 
  ggplot(aes(x = rfactor, y = avg_dist_salary)) + 
  # geom_text(aes(label = if_else(dis_name %in% outlier_disnames, as.character(dis_name), '')),
  #           hjust=0, vjust=0, size = 3, position = position_jitter(width = 0.01, height = 0, seed = 99)) +
  geom_point(position = position_jitter(width = 0.08, height = 0, seed = 99)) +
  # scale_x_continuous("Regionalization Factor", limits = c(.99, 1.28), breaks = c(1.00, 1.04, 1.06, 1.1, 1.12,
  #                                                                                1.16, 1.18, 1.22, 1.24, 1.28)) +
  scale_x_discrete("Regionalization Factor", breaks = c(1.00, 1.04, 1.06, 1.1, 1.12,
                                                        1.16, 1.18, 1.22, 1.24, 1.28)) +
  scale_y_continuous("Average District Teacher Salary", limits = c(30000, 100000), labels=scales::dollar_format()) +
  theme_classic() +
  theme(panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank()) +
  labs(title = "Scatterplot of (adjusted) teacher BASE salary and regionalization factor \nfor school districts during AY 2019-2020",
       subtitle = "normalized by (extrapolated) cost of wage index for each school district")

```

C.3. Poverty-level correlated with teacher salary adjusted local non-teacher wages (which is in the cost index database). use the correlation scatter plot similar as above in C.2 (poverty rate will be in the x-axis, while average teacher salary for each district for the average of 2018-19 and 2019-20 [adjusted for local non-teacher wages] will be in the y-axis). 
```{r C3}

# final salary
df_s275 %>% 
  filter(SchoolYear == "2018-2019" & !is.na(rfactor_cis_2019)) %>% 
  group_by(codist) %>% 
  mutate(avg_dist_salary = mean(tfinsal, na.rm = TRUE),
         dist_enroll = mean(dis_enroll.y, na.rm = TRUE)) %>% 
  slice_head() %>%
  ungroup() %>%
  ggplot(aes(x = dis_pctstu_frl, y = avg_dist_salary)) + 
  geom_point() + 
  geom_smooth(method='lm', aes(weight = dist_enroll), se = FALSE) +
  scale_y_continuous("Average District Teacher Salary", limits = c(30000, 100000), labels=scales::dollar_format()) +
  theme_classic() +
  theme(panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank()) +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x = "Share of students receiving FRPL",
       title = "Scatterplot of (unadjusted) teacher (final) salary and share of FRPL \nfor school districts during AY 2018-2019",
       caption = "Fitted line is weighted by district's enrollment size.")

df_s275 %>% 
  filter(SchoolYear == "2018-2019" & !is.na(rfactor_cis_2019)) %>% 
  left_join(df_cwi_2019, by = c("codist" = "dist_id")) %>% 
  group_by(codist) %>% 
  mutate(avg_dist_salary = mean(tfinsal, na.rm = TRUE)/cwi,
         dist_enroll = mean(dis_enroll.y, na.rm = TRUE)) %>% 
  slice_head() %>%
  ungroup() %>%
  ggplot(aes(x = dis_pctstu_frl, y = avg_dist_salary)) + 
  geom_point() + 
  geom_smooth(method='lm', aes(weight = dist_enroll), se = FALSE) +
  scale_y_continuous("Average District Teacher Salary", limits = c(30000, 100000), labels=scales::dollar_format()) +
  theme_classic() +
  theme(panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank()) +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x = "Share of students receiving FRPL",
       title = "Scatterplot of (adjusted) teacher (final) salary and share of FRPL \nfor school districts during AY 2018-2019",
       subtitle = "normalized by cost of wage index for each school district",
       caption = "Fitted line is weighted by district's enrollment size.")


# base salary
df_s275 %>% 
  filter(SchoolYear == "2018-2019" & !is.na(rfactor_cis_2019)) %>% 
  group_by(codist) %>% 
  mutate(avg_dist_salary = mean(certbase, na.rm = TRUE),
         dist_enroll = mean(dis_enroll.y, na.rm = TRUE)) %>% 
  slice_head() %>%
  ungroup() %>%
  ggplot(aes(x = dis_pctstu_frl, y = avg_dist_salary)) + 
  geom_point(aes(size = dist_enroll)) + 
  geom_smooth(method='lm', aes(weight = dist_enroll), se = FALSE) + 
  scale_y_continuous("Average District Teacher Salary", limits = c(30000, 100000), labels=scales::dollar_format()) +
  scale_size(name = "Dist. enroll size", breaks = c(1000, 10000, 25000, 50000), labels=scales::comma) +
  theme_classic() +
  theme(panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank()) +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x = "Share of students receiving FRPL",
       title = "Scatterplot of (unadjusted) teacher BASE salary and share of FRPL \nfor school districts during AY 2018-2019",
       caption = "Fitted line is weighted by district's enrollment size.")

df_s275 %>% 
  filter(SchoolYear == "2018-2019" & !is.na(rfactor_cis_2019)) %>% 
  left_join(df_cwi_2019, by = c("codist" = "dist_id")) %>% 
  group_by(codist) %>% 
  mutate(avg_dist_salary = mean(certbase, na.rm = TRUE)/cwi,
         dist_enroll = mean(dis_enroll.y, na.rm = TRUE)) %>% 
  slice_head() %>%
  ungroup() %>%
  ggplot(aes(x = dis_pctstu_frl, y = avg_dist_salary)) + 
  geom_point(aes(size = dist_enroll)) + 
  geom_smooth(method='lm', aes(weight = dist_enroll), se = FALSE) +
  scale_y_continuous("Average District Teacher Salary", limits = c(30000, 100000), labels=scales::dollar_format()) +
  scale_size(name = "Dist. enroll size", breaks = c(1000, 10000, 25000, 50000), labels=scales::comma) +
  theme_classic() +
  theme(panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank()) +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x = "Share of students receiving FRPL",
       title = "Scatterplot of (adjusted) teacher BASE salary and share of FRPL \nfor school districts during AY 2018-2019",
       subtitle = "normalized by cost of wage index for each school district",
       caption = "Fitted line is weighted by district's enrollment size.")


```
C.4. Share of Students of color is correlated with teacher salary adjusted local non-teacher wages (which is in the cost index database). use the correlation scatter plot similar as above in C.2 (percentage points of students of color will be in the x-axis, while average teacher salary for each district the average of 2018-19 and 2019-20 [adjusted for local non-teacher wages] will be in the y-axis). 
```{r C4}

# Final salary
df_s275 %>% 
  filter(SchoolYear == "2018-2019" & !is.na(rfactor_cis_2019)) %>% 
  group_by(codist) %>% 
  mutate(avg_dist_salary = mean(tfinsal, na.rm = TRUE),
         pctstu_nonwhite = mean(1 - dis_pctstu_white - dis_pctstu_asian, na.rm = TRUE),
         dist_enroll = mean(dis_enroll.y, na.rm = TRUE)) %>% 
  slice_head() %>%
  ungroup() %>%
  ggplot(aes(x = pctstu_nonwhite, y = avg_dist_salary)) + 
  geom_point() + 
  geom_smooth(method='lm', aes(weight = dist_enroll), se = FALSE) +
  scale_y_continuous("Average District Teacher Salary", limits = c(30000, 100000), labels=scales::dollar_format()) +
  theme_classic() +
  theme(panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank()) +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x = "Share of non-white students (excludes asian)",
       title = "Scatterplot of (unadjusted) teacher (final) salary and share of students of color \nfor school districts during AY 2018-2019",
       caption = "Fitted line is weighted by district's enrollment size.")

df_s275 %>% 
  filter(SchoolYear == "2018-2019" & !is.na(rfactor_cis_2019)) %>% 
  left_join(df_cwi_2019, by = c("codist" = "dist_id")) %>% 
  group_by(codist) %>% 
  mutate(avg_dist_salary = mean(tfinsal, na.rm = TRUE)/cwi,
         pctstu_nonwhite = mean(1 - dis_pctstu_white - dis_pctstu_asian, na.rm = TRUE),
         dist_enroll = mean(dis_enroll.y, na.rm = TRUE)) %>% 
  slice_head() %>%
  ungroup() %>%
  ggplot(aes(x = pctstu_nonwhite, y = avg_dist_salary)) + 
  geom_point() + 
  geom_smooth(method='lm', aes(weight = dist_enroll), se = FALSE) +
  scale_y_continuous("Average District Teacher Salary", limits = c(30000, 100000), labels=scales::dollar_format()) +
  theme_classic() +
  theme(panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank()) +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x = "Share of non-white students (exclude asian)",
       title = "Scatterplot of (adjusted) teacher (final) salary and share of students of color \nfor school districts during AY 2018-2019",
       subtitle = "normalized by cost of wage index for each school district",
       caption = "Fitted line is weighted by district's enrollment size.")


# Base salary
df_s275 %>% 
  filter(SchoolYear == "2018-2019" & !is.na(rfactor_cis_2019)) %>% 
  group_by(codist) %>% 
  mutate(avg_dist_salary = mean(certbase, na.rm = TRUE),
         pctstu_nonwhite = mean(1 - dis_pctstu_white - dis_pctstu_asian, na.rm = TRUE),
         dist_enroll = mean(dis_enroll.y, na.rm = TRUE)) %>% 
  slice_head() %>%
  ungroup() %>%
  ggplot(aes(x = pctstu_nonwhite, y = avg_dist_salary)) + 
  geom_point(aes(size = dist_enroll)) +
  geom_smooth(method='lm', aes(weight = dist_enroll), se = FALSE) +
  scale_y_continuous("Average District Teacher Salary", limits = c(30000, 100000), labels=scales::dollar_format()) +
  scale_size(name = "Dist. enroll size", breaks = c(1000, 10000, 25000, 50000), labels=scales::comma) +
  theme_classic() +
  theme(panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank()) +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x = "Share of non-white students (excludes asian)",
       title = "Scatterplot of (unadjusted) teacher BASE salary and share of students of color \nfor school districts during AY 2018-2019",
       caption = "Fitted line is weighted by district's enrollment size.")

df_s275 %>% 
  filter(SchoolYear == "2018-2019" & !is.na(rfactor_cis_2019)) %>% 
  left_join(df_cwi_2019, by = c("codist" = "dist_id")) %>% 
  group_by(codist) %>% 
  mutate(avg_dist_salary = mean(certbase, na.rm = TRUE)/cwi,
         pctstu_nonwhite = mean(1 - dis_pctstu_white - dis_pctstu_asian, na.rm = TRUE),
         dist_enroll = mean(dis_enroll.y, na.rm = TRUE)) %>% 
  slice_head() %>%
  ungroup() %>%
  ggplot(aes(x = pctstu_nonwhite, y = avg_dist_salary)) + 
  geom_point(aes(size = dist_enroll)) + 
  geom_smooth(method='lm', aes(weight = dist_enroll), se = FALSE) +
  scale_y_continuous("Average District Teacher Salary", limits = c(30000, 100000), labels=scales::dollar_format()) +
  scale_size(name = "Dist. enroll size", breaks = c(1000, 10000, 25000, 50000), labels=scales::comma) +
  theme_classic() +
  theme(panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank()) +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x = "Share of non-white students (exclude asian)",
       title = "Scatterplot of (adjusted) teacher BASE salary and share of students of color \nfor school districts during AY 2018-2019",
       subtitle = "normalized by cost of wage index for each school district",
       caption = "Fitted line is weighted by district's enrollment size.")
```

```{r C5}

```

C6. Teacher workforce (Racial/Ethnic composition, educational attainment and experiences), by Student (high-vs-low poverty; by high- vs. -low students of color).
```{r C6}

df_s275 %>% 
  group_by(schyear) %>% 
  summarize(mean_dist_tch_black = mean(race == "B" & hispanic == "N", na.rm = TRUE),
            mean_dist_tch_asian = mean(race == "A" & hispanic == "N", na.rm = TRUE),
            mean_dist_tch_hisp = mean(hispanic == "Y", na.rm = TRUE),
            # mean_dist_tch_white = mean(race == "W" & hispanic == "N", na.rm = TRUE),
            mean_dist_tch_nonwhite = mean((race != "W" & race != "A") | (race == "W" & hispanic == "Y"), na.rm = TRUE),
            mean_dist_tch_nonwhite1 = mean(race != "W" | (race == "W" & hispanic == "Y"), na.rm = TRUE)) %>% 
  ggplot(aes(x = schyear)) +
  geom_line(aes(y = mean_dist_tch_black, color = "Black")) +
  geom_line(aes(y = mean_dist_tch_hisp, color = "Hispanic")) +
  geom_line(aes(y = mean_dist_tch_asian, color = "Asian")) +
  geom_line(aes(y = mean_dist_tch_nonwhite, color = "Non-white (excl. asian)")) +
  geom_line(aes(y = mean_dist_tch_nonwhite1, color = "Non-white")) +
  scale_color_manual(name='Teacher race', values=c('Black'='green', 'Hispanic'='blue', 'Asian'='red',
                                       'Non-white'='black', 'Non-white (excl. asian)'='gray')) +
  scale_y_continuous(labels = scales::percent) +
  theme_bw() +
  labs(y =  "",
       x = "",
       title = "Share of non-white teachers across WA school districts between AY 2015-2016 to 2020-2021")


df_s275 %>% 
  filter(schyear == 2020) %>% 
  mutate(exp_bin = if_else(exp <= 3, "early-career",
                           if_else(exp > 3 & exp <= 7, "junior",
                                   if_else(exp > 7 & exp <= 11, "mid-career 1",
                                           if_else(exp > 11 & exp <= 15, "mid-career 2",
                                                   if_else(exp > 15 & exp <= 19, "late-career 1",
                                                           if_else(exp > 19 & exp <= 22, "late-career 2",
                                                                   if_else(exp > 22, "late-career 3", "FLAG"))))))),
         exp_bin = factor(exp_bin, levels = c("early-career", "junior", "mid-career 1", "mid-career 2",
                                              "late-career 1", "late-career 2", "late-career 3"))) %>% 
  group_by(exp_bin) %>% 
  summarize(share_black = mean(race == "B" & hispanic == "N", na.rm = TRUE),
            num_black = sum(race == "B" & hispanic == "N", na.rm = TRUE),
            share_asian = mean(race == "A" & hispanic == "N", na.rm = TRUE),
            num_asian = sum(race == "A" & hispanic == "N", na.rm = TRUE),
            share_hisp = mean(hispanic == "Y", na.rm = TRUE),
            num_hisp = sum(hispanic == "Y", na.rm = TRUE),
            # share_white = mean(race == "W" & hispanic == "N", na.rm = TRUE),
            share_nonwhite = mean((race != "W" & race != "A") | (race == "W" & hispanic == "Y"), na.rm = TRUE),
            num_nonwhite = sum((race != "W" & race != "A") | (race == "W" & hispanic == "Y"), na.rm = TRUE),
            share_nonwhite1 = mean(race != "W" | (race == "W" & hispanic == "Y"), na.rm = TRUE),
            num_nonwhite1 = sum(race != "W" | (race == "W" & hispanic == "Y"), na.rm = TRUE)) %>% 
  pivot_longer(cols = c(starts_with("share_"), starts_with("num_")), names_to = c(".value", "race"), names_pattern = "(.*)_(.*)") %>% 
  ggplot(aes(x = exp_bin, y = share, fill = race)) +
  geom_col(position = 'dodge') +
  geom_text(aes(label = num), position = position_dodge(width = 0.9), vjust = -0.5) +
  scale_fill_discrete("",breaks = c("black", "asian", "hisp", "nonwhite", "nonwhite1"),
                      labels = c("Black", "Asian", "Hispanic", "Non-white (excl. asian)", "Non-white")) +
  scale_y_continuous(labels = scales::percent) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x = "", y = "",
       title = "Share of non-white teachers by experience in WA state during AY 2019-2020",
       caption = "experience categories: early-career (0−3 years of teaching experience); junior (4−7); mid-career 1 (8−11); mid-career 2 (12−15);late-career 1(16−19); late-career 2(20−22); and late-career 3 (23 and above).\nNumber of teachers in each category are also reported on top of each bar.")









df_s275_dist <- df_s275 %>% 
  filter(SchoolYear == "2018-2019" & !is.na(rfactor_cis_2019)) %>% 
  mutate(rfactor = as.character(rfactor_cis_2019)) %>% 
  group_by(coudis_s, rfactor) %>% 
  summarize(mean_dist_tch_black = mean(race == "B", na.rm = TRUE),
            mean_dist_tch_asian = mean(race == "A", na.rm = TRUE),
            mean_dist_tch_hisp = mean(hispanic == "Y", na.rm = TRUE),
            mean_dist_tch_white = mean(race == "W" & hispanic == "N", na.rm = TRUE),
            mean_dist_tch_nonwhite = mean((race != "W" & race != "A") | (race == "W" & hispanic == "Y"), na.rm = TRUE),
            mean_dist_tch_nonwhite1 = mean(race != "W" | (race == "W" & hispanic == "Y"), na.rm = TRUE),
            
            dist_enroll = mean(dis_enroll.y, na.rm = TRUE),
            
            dist_pctstu_black = mean(replace_na(dis_pctstu_black, 0)),
            dist_pctstu_asian = mean(replace_na(dis_pctstu_asian, 0)),

            dist_pctstu_black = mean(dis_pctstu_black, na.rm = TRUE),
            dist_pctstu_asian = mean(dis_pctstu_asian, na.rm = TRUE),
            dist_pctstu_hisp = mean(dis_pctstu_hispanic, na.rm = TRUE),
            dist_pctstu_white = mean(dis_pctstu_white, na.rm = TRUE),
            dist_pctstu_asian = mean(dis_pctstu_asian, na.rm = TRUE),
            dist_pctstu_nonwhite = 1 - dist_pctstu_white - dist_pctstu_asian,
            dist_pctstu_nonwhite1 = 1 - dist_pctstu_white,

            dist_pctstu_frpl = mean(replace_na(dis_pctstu_frl, 0)),

            mean_dist_tch_bachelor = mean(hdeg %in% c("B", "H", "G"), na.rm = TRUE),
            mean_dist_tch_master = mean(hdeg %in% c("M", "m"), na.rm = TRUE),
            mean_dist_tch_doctorate = mean(hdeg == "D", na.rm = TRUE),
            mean_dist_tch_master_plus = mean(hdeg %in% c("M", "m", "D"), na.rm = TRUE),
            mean_dist_tch_nobachelor = mean(hdeg %in% c("", "S", "V"), na.rm = TRUE),

            mean_dist_tch_exp = mean(exp, na.rm = TRUE),

            dist_nonwhite_cat = if_else(dist_pctstu_nonwhite < 0.26, "0 to 25%",
                                        if_else(dist_pctstu_nonwhite >= 0.26 & dist_pctstu_nonwhite < 0.51, "26 to 50%",
                                                if_else(dist_pctstu_nonwhite >= 0.51 & dist_pctstu_nonwhite < 0.76, "51 to 75%",
                                                        if_else(dist_pctstu_nonwhite >= 0.76, "76 to 100%", "FLAG")))),
            dist_nonwhite_cat1 = if_else(dist_pctstu_nonwhite1 < 0.26, "0 to 25%",
                                        if_else(dist_pctstu_nonwhite1 >= 0.26 & dist_pctstu_nonwhite1 < 0.51, "26 to 50%",
                                                if_else(dist_pctstu_nonwhite1 >= 0.51 & dist_pctstu_nonwhite1 < 0.76, "51 to 75%",
                                                        if_else(dist_pctstu_nonwhite1 >= 0.76, "76 to 100%", "FLAG")))),
            dist_poverty_cat = if_else(dist_pctstu_frpl < 0.26, "0 to 25%",
                                       if_else(dist_pctstu_frpl >= 0.26 & dist_pctstu_frpl < 0.51, "26 to 50%",
                                               if_else(dist_pctstu_frpl >= 0.51 & dist_pctstu_frpl < 0.76, "51 to 75%",
                                                       if_else(dist_pctstu_frpl >= 0.76, "76 to 100%", "FLAG"))))
            )


### teacher racial composition and share of students of color
df_s275_dist %>% 
  ggplot(aes(x = dist_pctstu_nonwhite, y = mean_dist_tch_nonwhite)) +
  geom_point(aes(size = dist_enroll)) +
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_size(name = "Dist. enroll size", breaks = c(1000, 10000, 25000, 50000), labels=scales::comma) +
  labs(x = "Share of students of color",
       y = "Share of non-white teachers",
       title = "Scatterplot of share of nonwhite teachers and students of color by district enrollment size\nacross WA school districtsin AY 2018-2019",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.\nFitted line is weighted by district's enrollment size.")

df_s275_dist %>% 
  ggplot(aes(x = dist_pctstu_black, y = mean_dist_tch_black)) +
  geom_point(aes(size = dist_enroll)) +
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face = "italic")) +
  scale_size(name = "Dist. enroll size", breaks = c(1000, 10000, 25000, 50000), labels=scales::comma) +
  labs(x = "Share of black students",
       y = "Share of black teachers",
       title = "Scatterplot of share of black teachers and black students by district enrollment size\nacross WA school districtsin AY 2018-2019",
       caption = "Fitted line is weighted by district's enrollment size.")

df_s275_dist %>% 
  ggplot(aes(x = dist_pctstu_hisp, y = mean_dist_tch_hisp)) +
  geom_point(aes(size = dist_enroll)) +
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_size(name = "Dist. enroll size", breaks = c(1000, 10000, 25000, 50000), labels=scales::comma) +
  labs(x = "Share of hispanic students",
       y = "Share of hispanic teachers",
       title = "Scatterplot of share of hispanic teachers and hispanic students by district enrollment size\nacross WA school districtsin AY 2018-2019",
       caption = "Fitted line is weighted by district's enrollment size.")

df_s275_dist %>% 
  ggplot(aes(x = dist_pctstu_asian, y = mean_dist_tch_asian)) +
  geom_point(aes(size = dist_enroll)) +
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_size(name = "Dist. enroll size", breaks = c(1000, 10000, 25000, 50000), labels=scales::comma) +
  labs(x = "Share of asian students",
       y = "Share of asian teachers",
       title = "Scatterplot of share of asian teachers and asian students by district enrollment size\nacross WA school districtsin AY 2018-2019",
       caption = "Fitted line is weighted by district's enrollment size.")

df_s275_dist %>% 
  ggplot(aes(x = dist_pctstu_white, y = mean_dist_tch_white)) +
  geom_point(aes(size = dist_enroll)) +
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_size(name = "Dist. enroll size", breaks = c(1000, 10000, 25000, 50000), labels=scales::comma) +
  labs(x = "Share of white students",
       y = "Share of white teachers",
       title = "Scatterplot of share of white teachers and white students by district enrollment size\nacross WA school districtsin AY 2018-2019",
       caption = "Fitted line is weighted by district's enrollment size.")


df_s275_dist %>%
  ggplot(aes(x = mean_dist_tch_nonwhite, color = dist_nonwhite_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 0.5) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of non-white teachers",
       y = "",
       color = "Share of students of\ncolor in a district",
       title = "Density of non-white teachers across WA school districts in AY 2018-2019\nby low to high shares of students of color",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")

df_s275_dist %>% 
  filter(dist_nonwhite_cat %in% c("0 to 25%", "76 to 100%")) %>% 
  ggplot(aes(x = mean_dist_tch_nonwhite, color = dist_nonwhite_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 0.5) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of non-white teachers",
       y = "",
       color = "Share of students of\ncolor in a district",
       title = "Density of non-white teachers across WA school districts in AY 2018-2019 by low to high shares of students of color",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")



# including asians as non-white
df_s275_dist %>% 
  ggplot(aes(x = dist_pctstu_nonwhite1, y = mean_dist_tch_nonwhite1)) +
  geom_point(aes(size = dist_enroll)) +
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_size(name = "Dist. enroll size", breaks = c(1000, 10000, 25000, 50000), labels=scales::comma) +
  labs(x = "Share of students of color",
       y = "Share of non-white teachers",
       title = "Scatterplot of share of nonwhite teachers and students of color by district enrollment size\nacross WA school districtsin AY 2018-2019",
       caption = "In all estimates, asians are included in non-white and people of color categories.\nFitted line is weighted by district's enrollment size.")

df_s275_dist %>% 
  filter(dist_nonwhite_cat1 %in% c("0 to 25%", "76 to 100%")) %>% 
  ggplot(aes(x = mean_dist_tch_nonwhite1, color = dist_nonwhite_cat1)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 0.5) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of non-white teachers",
       y = "",
       color = "Share of students of\ncolor in a district",
       title = "Density of non-white teachers across WA school districts in AY 2018-2019\nby low to high shares of students of color",
       caption = "In all estimates, asians are included in non-white and people of color categories.")






### teacher racial composition and share of students in poverty
df_s275_dist %>% 
  ggplot(aes(x = dist_pctstu_frpl, y = mean_dist_tch_nonwhite)) +
  geom_point(aes(size = dist_enroll)) + 
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +  
  scale_size(name = "Dist. enroll size", breaks = c(1000, 10000, 25000, 50000), labels=scales::comma) +
  labs(x = "Share of students receiving FRPL",
       y = "Share of non-white teachers",
       title = "Scatterplot of share of nonwhite teachers and students poverty (measured by FRPL) across WA school districts\nin AY 2018-2019",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.\nFitted line is weighted by district's enrollment size.")

df_s275_dist %>%
  ggplot(aes(x = mean_dist_tch_nonwhite, color = dist_poverty_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 0.4) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of non-white teachers",
       y = "",
       color = "Share of students\nreceiving FRPL",
       title = "Density of non-white teachers across WA school districts in AY 2018-2019\nby low to high shares of students poverty (measured by FRPL)",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")

df_s275_dist %>% 
  filter(dist_poverty_cat %in% c("0 to 25%", "76 to 100%")) %>% 
  ggplot(aes(x = mean_dist_tch_nonwhite, color = dist_poverty_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 0.4) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of non-white teachers",
       y = "",
       color = "Share of students\nreceiving FRPL",
       title = "Density of non-white teachers across WA school districts in AY 2018-2019\nby low to high shares of students poverty (measured by FRPL)",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")


### teacher educational attainment and share of students of color
# bachelor
df_s275_dist %>%
  ggplot(aes(x = dist_pctstu_nonwhite, y = mean_dist_tch_bachelor)) +
  geom_point(aes(size = dist_enroll)) + 
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_size(name = "Dist. enroll size", breaks = c(1000, 10000, 25000, 50000), labels=scales::comma) +
  labs(x =  "Share of students of color in a district",
       y = "Share of teachers with bachelor's",
       title = "Scatterplot of share of teachers with highest degree as bachelor's and share of students of color\nacross WA school districts in AY 2018-2019",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.\nFitted line is weighted by district's enrollment size.")

df_s275_dist %>%
  ggplot(aes(x = mean_dist_tch_bachelor, color = dist_nonwhite_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 0.9) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of teachers with bachelor's",
       y = "",
       color = "Share of students of\ncolor in a district",
       title = "Density of share of teachers with highest degree as bachelor's across WA school districts\nin AY 2018-2019 by low to high shares of students of color",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")

df_s275_dist %>% 
  filter(dist_nonwhite_cat %in% c("0 to 25%", "76 to 100%")) %>% 
  ggplot(aes(x = mean_dist_tch_bachelor, color = dist_nonwhite_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 0.9) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of teachers with bachelor's",
       y = "",
       color = "Share of students of\ncolor in a district",
       title = "Density of share of teachers with highest degree as bachelor's across WA school districts\nin AY 2018-2019 by low to high shares of students of color",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")

# master
df_s275_dist %>%
  ggplot(aes(x = dist_pctstu_nonwhite, y = mean_dist_tch_master)) +
  geom_point(aes(size = dist_enroll)) + 
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_size(name = "Dist. enroll size", breaks = c(1000, 10000, 25000, 50000), labels=scales::comma) +
  labs(x =  "Share of students of color in a district",
       y = "Share of teachers with master's",
       title = "Scatterplot of share of teachers with highest degree as master's and share of students of color across WA school districts\nin AY 2018-2019",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.\nFitted line is weighted by district's enrollment size.")

df_s275_dist %>%
  ggplot(aes(x = mean_dist_tch_master, color = dist_nonwhite_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 1) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of teachers with master's",
       y = "",
       color = "Share of students of\ncolor in a district",
       title = "Density of share of teachers with highest degree as master's across WA school districts\nin AY 2018-2019 by low to high shares of students of color",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")

df_s275_dist %>% 
  filter(dist_nonwhite_cat %in% c("0 to 25%", "76 to 100%")) %>% 
  ggplot(aes(x = mean_dist_tch_master, color = dist_nonwhite_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 1) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of teachers with master's",
       y = "",
       color = "Share of students of\ncolor in a district",
       title = "Density of share of teachers with highest degree as master's across WA school districts\nin AY 2018-2019 by low to high shares of students of color",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")

# doctorate
df_s275_dist %>%
  ggplot(aes(x = dist_pctstu_nonwhite, y = mean_dist_tch_doctorate)) +
  geom_point(aes(size = dist_enroll)) + 
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_size(name = "Dist. enroll size", breaks = c(1000, 10000, 25000, 50000), labels=scales::comma) +
  labs(x =  "Share of students of color in a district",
       y = "Share of teachers with doctorate's",
       title = "Scatterplot of share of teachers with highest degree as doctorate's and share of students of color across WA school districts\nin AY 2018-2019",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.\nFitted line is weighted by district's enrollment size.")

df_s275_dist %>%
  ggplot(aes(x = mean_dist_tch_doctorate, color = dist_nonwhite_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 0.15) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of teachers with doctorate's",
       y = "",
       color = "Share of students of\ncolor in a district",
       title = "Density of share of teachers with highest degree as doctorate's across WA school districts\nin AY 2018-2019 by low to high shares of students of color",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")

df_s275_dist %>% 
  filter(dist_nonwhite_cat %in% c("0 to 10%", "76 to 100%")) %>% 
  ggplot(aes(x = mean_dist_tch_doctorate, color = dist_nonwhite_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, .15) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of teachers with doctorate's",
       y = "",
       color = "Share of students of\ncolor in a district",
       title = "Density of share of teachers with highest degree as doctorate's across WA school districts\nin AY 2018-2019 by low to high shares of students of color",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")

# master or doctorate
df_s275_dist %>%
  ggplot(aes(x = dist_pctstu_nonwhite, y = mean_dist_tch_master_plus)) +
  geom_point(aes(size = dist_enroll)) + 
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_size(name = "Dist. enroll size", breaks = c(1000, 10000, 25000, 50000), labels=scales::comma) +
  labs(x =  "Share of students of color in a district",
       y = "Share of teachers with master's/doctorate",
       title = "Scatterplot of share of teachers with highest degree as master's or doctorate and share of students of color across WA school districts\nin AY 2018-2019",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.\nFitted line is weighted by district's enrollment size.")

df_s275_dist %>%
  ggplot(aes(x = mean_dist_tch_master_plus, color = dist_nonwhite_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 1) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of teachers with master's/doctorate",
       y = "",
       color = "Share of students of\ncolor in a district",
       title = "Density of share of teachers with highest degree as master's or doctorate across WA school districts\nin AY 2018-2019 by low to high shares of students of color",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")

df_s275_dist %>% 
  filter(dist_nonwhite_cat %in% c("0 to 25%", "76 to 100%")) %>% 
  ggplot(aes(x = mean_dist_tch_master, color = dist_nonwhite_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 1) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of teachers with master's/doctorate",
       y = "",
       color = "Share of students of\ncolor in a district",
       title = "Density of share of teachers with highest degree as master's or doctorate across WA school districts\nin AY 2018-2019 by low to high shares of students of color",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")


# no bachelor
df_s275_dist %>%
  ggplot(aes(x = dist_pctstu_nonwhite, y = mean_dist_tch_nobachelor)) +
  geom_point(aes(size = dist_enroll)) + 
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_size(name = "Dist. enroll size", breaks = c(1000, 10000, 25000, 50000), labels=scales::comma) +
  labs(x =  "Share of students of color in a district",
       y = "Share of teachers with no bachelor's",
       title = "Scatterplot of share of teachers with no bachelor's and share of students of color across WA school districts\nin AY 2018-2019",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.\nFitted line is weighted by district's enrollment size.")

df_s275_dist %>%
  ggplot(aes(x = mean_dist_tch_nobachelor, color = dist_nonwhite_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 0.3) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of teachers with no bachelor's",
       y = "",
       color = "Share of students of\ncolor in a district",
       title = "Density of share of teachers with no bachelor's degree across WA school districts\nin AY 2018-2019 by low to high shares of students of color",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")

df_s275_dist %>% 
  filter(dist_nonwhite_cat %in% c("0 to 25%", "76 to 100%")) %>% 
  ggplot(aes(x = mean_dist_tch_nobachelor, color = dist_nonwhite_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, .3) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of teachers with no bachelor's",
       y = "",
       color = "Share of students of\ncolor in a district",
       title = "Density of share of teachers with no bachelor's degree across WA school districts\nin AY 2018-2019 by low to high shares of students of color",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")



### teacher educational attainment and share of students in poverty
# bachelor
df_s275_dist %>%
  ggplot(aes(x = dist_pctstu_frpl, y = mean_dist_tch_bachelor)) +
  geom_point(aes(size = dist_enroll)) + 
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_size(name = "Dist. enroll size", breaks = c(1000, 10000, 25000, 50000), labels=scales::comma) +
  labs(x =  "Share of students receiving FRPL",
       y = "Share of teachers with bachelor's",
       title = "Scatterplot of share of teachers with highest degree as bachelor's and share of students poverty (measured by FRPL) across WA school districts\nin AY 2018-2019",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.\nFitted line is weighted by district's enrollment size.")

df_s275_dist %>%
  ggplot(aes(x = mean_dist_tch_bachelor, color = dist_nonwhite_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 0.9) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of teachers with bachelor's",
       y = "",
       color = "Share of students\nreceiving FRPL",
       title = "Density of share of teachers with highest degree as bachelor's across WA school districts\nin AY 2018-2019 by low to high shares of students poverty (measured by FRPL) ",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")

df_s275_dist %>% 
  filter(dist_nonwhite_cat %in% c("0 to 25%", "76 to 100%")) %>% 
  ggplot(aes(x = mean_dist_tch_bachelor, color = dist_nonwhite_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 0.9) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of teachers with bachelor's",
       y = "",
       color = "Share of students\nreceiving FRPL",
       title = "Density of share of teachers with highest degree as bachelor's across WA school districts\nin AY 2018-2019 by low to high shares of students poverty (measured by FRPL)",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")

# master
df_s275_dist %>%
  ggplot(aes(x = dist_pctstu_nonwhite, y = mean_dist_tch_master)) +
  geom_point(aes(size = dist_enroll)) + 
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_size(name = "Dist. enroll size", breaks = c(1000, 10000, 25000, 50000), labels=scales::comma) +
  labs(x =  "Share of students receiving FRPL",
       y = "Share of teachers with master's",
       title = "Scatterplot of share of teachers with highest degree as master's and share of students poverty (measured by FRPL)  across WA school districts\nin AY 2018-2019",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.\nFitted line is weighted by district's enrollment size.")

df_s275_dist %>%
  ggplot(aes(x = mean_dist_tch_master, color = dist_nonwhite_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 1) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of teachers with master's",
       y = "",
       color = "Share of students\nreceiving FRPL",
       title = "Density of share of teachers with highest degree as master's across WA school districts\nin AY 2018-2019 by low to high shares of students poverty (measured by FRPL)",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")

df_s275_dist %>% 
  filter(dist_nonwhite_cat %in% c("0 to 25%", "76 to 100%")) %>% 
  ggplot(aes(x = mean_dist_tch_master, color = dist_nonwhite_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 1) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of teachers with master's",
       y = "",
       color = "Share of students\nreceiving FRPL",
       title = "Density of share of teachers with highest degree as master's across WA school districts\nin AY 2018-2019 by low to high shares of students poverty (measured by FRPL)",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")


# master or doctorate
df_s275_dist %>%
  ggplot(aes(x = dist_pctstu_nonwhite, y = mean_dist_tch_master_plus)) +
  geom_point(aes(size = dist_enroll)) + 
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_size(name = "Dist. enroll size", breaks = c(1000, 10000, 25000, 50000), labels=scales::comma) +
  labs(x =  "Share of students receiving FRPL",
       y = "Share of teachers with master's/doctorate",
       title = "Scatterplot of share of teachers with highest degree as master's or doctorate and share of students poverty (measured by FRPL)  across WA school districts\nin AY 2018-2019",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.\nFitted line is weighted by district's enrollment size.")

df_s275_dist %>%
  ggplot(aes(x = mean_dist_tch_master_plus, color = dist_nonwhite_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 1) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of teachers with master's/doctorate",
       y = "",
       color = "Share of students\nreceiving FRPL",
       title = "Density of share of teachers with highest degree as master's or doctorate across WA school districts\nin AY 2018-2019 by low to high shares of students poverty (measured by FRPL)",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")

df_s275_dist %>% 
  filter(dist_nonwhite_cat %in% c("0 to 25%", "76 to 100%")) %>% 
  ggplot(aes(x = mean_dist_tch_master_plus, color = dist_nonwhite_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 1) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of teachers with master's/doctorate",
       y = "",
       color = "Share of students\nreceiving FRPL",
       title = "Density of share of teachers with highest degree as master's or doctorate across WA school districts\nin AY 2018-2019 by low to high shares of students poverty (measured by FRPL)",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")


# no bachelor
df_s275_dist %>%
  ggplot(aes(x = dist_pctstu_frpl, y = mean_dist_tch_nobachelor)) +
  geom_point(aes(size = dist_enroll)) + 
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_size(name = "Dist. enroll size", breaks = c(1000, 10000, 25000, 50000), labels=scales::comma) +
  labs(x =  "Share of students receiving FRPL",
       y = "Share of teachers with no bachelor's",
       title = "Scatterplot of share of teachers with no bachelor's and share of students poverty (measured by FRPL) across WA school districts\nin AY 2018-2019",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.\nFitted line is weighted by district's enrollment size.")

df_s275_dist %>%
  ggplot(aes(x = mean_dist_tch_nobachelor, color = dist_poverty_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 0.3) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of teachers with no bachelor's",
       y = "",
       color = "Share of students\nreceiving FRPL",
       title = "Density of share of teachers with no bachelor's degree across WA school districts\nin AY 2018-2019 by low to high shares of students poverty (measured by FRPL)",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")

df_s275_dist %>% 
  filter(dist_poverty_cat %in% c("0 to 25%", "76 to 100%")) %>% 
  ggplot(aes(x = mean_dist_tch_nobachelor, color = dist_poverty_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, .3) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Share of teachers with no bachelor's",
       y = "",
       color = "Share of students\nreceiving FRPL",
       title = "Density of share of teachers with no bachelor's degree across WA school districts\nin AY 2018-2019 by low to high shares of students poverty (measured by FRPL)",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")




### teacher experience and share of students of color
df_s275_dist %>%
  ggplot(aes(x = dist_pctstu_nonwhite, y = mean_dist_tch_exp)) +
  geom_point(aes(size = dist_enroll)) + 
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_size(name = "Dist. enroll size", breaks = c(1000, 10000, 25000, 50000), labels=scales::comma) +
  labs(x =  "Share of students of color",
       y = "Average teacher experience (in years)",
       title = "Scatterplot of average teachers experience and share of students of color across WA school districts\nin AY 2018-2019",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.\nFitted line is weighted by district's enrollment size.")

df_s275_dist %>% 
  ggplot(aes(x = mean_dist_tch_exp, color = dist_nonwhite_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 30) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Average teacher experience (in years)",
       y = "",
       color = "Share of students of\ncolor in a district",
       title = "Density of average teacher experience across WA school districts in AY 2018-2019\nby low to high shares of students of color",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")

df_s275_dist %>% 
  filter(dist_nonwhite_cat %in% c("0 to 25%", "76 to 100%")) %>% 
  ggplot(aes(x = mean_dist_tch_exp, color = dist_nonwhite_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 30) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Average teacher experience (in years)",
       y = "",
       color = "Share of students of\ncolor in a district",
       title = "Density of average teacher experience across WA school districts in AY 2018-2019\nby low to high shares of students of color",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")



### teacher experience and share of students in poverty
df_s275_dist %>%
  ggplot(aes(x = dist_pctstu_frpl, y = mean_dist_tch_exp)) +
  geom_point(aes(size = dist_enroll)) + 
  geom_smooth(method = "lm", aes(weight = dist_enroll), se = FALSE) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_size(name = "Dist. enroll size", breaks = c(1000, 10000, 25000, 50000), labels=scales::comma) +
  labs(x =  "Share of students receiving FRPL",
       y = "Average teacher experience (in years)",
       title = "Scatterplot of average teachers experience and share of students poverty (measured by FRPL) across WA school districts\nin AY 2018-2019",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.\nFitted line is weighted by district's enrollment size.")

df_s275_dist %>% 
  ggplot(aes(x = mean_dist_tch_exp, color = dist_poverty_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 30) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Average teacher experience (in years)",
       y = "",
       color = "Share of students\nreceiving FRPL",
       title = "Density of average teacher experience across WA school districts in AY 2018-2019\nby low to high shares of students poverty (measured by FRPL)",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")

df_s275_dist %>% 
  filter(dist_poverty_cat %in% c("0 to 25%", "76 to 100%")) %>% 
  ggplot(aes(x = mean_dist_tch_exp, color = dist_poverty_cat)) +
  geom_density(aes(y=..scaled..)) + 
  xlim(0, 30) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  labs(x =  "Average teacher experience (in years)",
       y = "",
       color = "Share of students\nreceiving FRPL",
       title = "Density of average teacher experience across WA school districts in AY 2018-2019\nby low to high shares of students poverty (measured by FRPL)",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.")


```

C7. Line charts: 
Teacher turnover (/ teacher newcomers to the district per 1000 students; average experiences of teachers)= districts’ poverty rates
```{r C7}
id_dis_stu_2020_2021 <- drive_get(as_id("https://drive.google.com/file/d/1eLno4-z6GuoQMSBKzBk019tGaq3KSk3q/view?usp=sharing"))

df_dist_stu_2020_2021 <- id_dis_stu_2020_2021 %>%
  drive_read_raw() %>%
  read_csv()

df_s275_turnover <- df_s275 %>% 
  left_join(df_dist_stu_2020_2021, by = c("codist", "schyear"), suffix = c("", "_new")) %>% 
  mutate(dis_pctstu_white = if_else(schyear <= 2019, dis_pctstu_white, dis_pctstu_white_new),
         dis_pctstu_black = if_else(schyear <= 2019, dis_pctstu_black, dis_pctstu_black_new),
         dis_pctstu_asian = if_else(schyear <= 2019, dis_pctstu_asian, dis_pctstu_asian_new),
         dis_pctstu_hispanic = if_else(schyear <= 2019, dis_pctstu_hispanic, dis_pctstu_hispanic_new),
         dis_pctstu_frl = if_else(schyear <= 2019, dis_pctstu_frl, dis_pctstu_frl_new)) %>% 
  filter(cert != "") %>% 
  group_by(cert) %>% 
  mutate(next_yr_coudis = dplyr::lead(coudis_s, order_by = schyear),
         tch_turnover = if_else(coudis_s == next_yr_coudis & !is.na(next_yr_coudis), "same_dist_tch",
                                if_else(coudis_s != next_yr_coudis & !is.na(next_yr_coudis), "diff_dist_tch",
                                        if_else(is.na(next_yr_coudis), "leave", "FLAG"))),
         tch_newcomer1 = if_else(is.na(dplyr::lag(cert, order_by = schyear)), 1, 0),
         tch_newcomer2 = if_else(is.na(dplyr::lag(cert, order_by = schyear)) | coudis_s != dplyr::lag(coudis_s, order_by = schyear), 1, 0)) %>% 
  ungroup() %>% 
  group_by(coudis_s, schyear) %>% 
  mutate(dist_pctstu_nonwhite = 1 - mean(dis_pctstu_white, na.rm = TRUE) - mean(dis_pctstu_asian, na.rm = TRUE),
         dist_pctstu_frpl = mean(dis_pctstu_frl, na.rm = TRUE),
         dist_nonwhite_cat = if_else(dist_pctstu_nonwhite < 0.26, "0 to 25%",
                                     if_else(dist_pctstu_nonwhite >= 0.26 & dist_pctstu_nonwhite < 0.51, "26 to 50%",
                                             if_else(dist_pctstu_nonwhite >= 0.51 & dist_pctstu_nonwhite < 0.76, "51 to 75%",
                                                     if_else(dist_pctstu_nonwhite >= 0.76, "76 to 100%", "FLAG")))),
         dist_poverty_cat = if_else(dist_pctstu_frpl < 0.26, "0 to 25%",
                                    if_else(dist_pctstu_frpl >= 0.26 & dist_pctstu_frpl < 0.51, "26 to 50%",
                                            if_else(dist_pctstu_frpl >= 0.51 & dist_pctstu_frpl < 0.76, "51 to 75%",
                                                    if_else(dist_pctstu_frpl >= 0.76, "76 to 100%", "FLAG")))),
         dist_enroll_size = mean(dis_enroll.y)) %>% 
  ungroup()



# teacher turnover by students of color and poverty
df_s275_turnover %>% 
  filter(dist_nonwhite_cat %in% c("0 to 25%", "76 to 100%") & schyear < 2021) %>%
  group_by(schyear, dist_nonwhite_cat) %>% 
  summarize(tch_leavers = mean(tch_turnover == "leave"),
            tch_movers = mean(tch_turnover == "diff_dist_tch")) %>% 
  ggplot(aes(x = schyear, color = dist_nonwhite_cat)) +
  geom_line(aes(y = tch_leavers, linetype = "Leavers")) +
  geom_point(aes(y = tch_leavers, color = dist_nonwhite_cat)) +
  ylim(0, 0.15) +
  geom_line(aes(y = tch_movers, linetype = "Movers")) + 
  geom_point(aes(y = tch_movers, color = dist_nonwhite_cat)) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_linetype_manual(values = c('Leavers' = 'solid', 'Movers' = 'dashed'), labs(color = 'Turnover type')) +
  labs(x = "",
       y = "Turnover rate",
       color = "Share of students\nof color",
       title = "Average teacher turnover rate by high vs. low students of color in WA state\nbetween AY 2015-2016 to 2019-2020",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.\nleavers are teachers who left the teaching profession or the system and movers are those who move to another district.")



df_s275_turnover %>% 
  filter(dist_poverty_cat %in% c("0 to 25%", "76 to 100%") & schyear < 2021) %>%
  group_by(schyear, dist_poverty_cat) %>% 
  summarize(tch_leavers = mean(tch_turnover == "leave"),
            tch_movers = mean(tch_turnover == "diff_dist_tch")) %>% 
  ggplot(aes(x = schyear, color = dist_poverty_cat)) +
  geom_line(aes(y = tch_leavers, linetype = "Leavers")) +
  geom_point(aes(y = tch_leavers, color = dist_poverty_cat)) +
  ylim(0, 0.15) +
  geom_line(aes(y = tch_movers, linetype = "Movers")) + 
  geom_point(aes(y = tch_movers, color = dist_poverty_cat)) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_linetype_manual(values = c('Leavers' = 'solid', 'Movers' = 'dashed'), labs(color = 'Turnover type')) +
  labs(x = "",
       y = "Turnover rate",
       color = "Share of students\nreceiving FRPL",
       title = "Average teacher turnover rate by high vs. low poverty in WA state\nbetween AY 2015-2016 to 2019-2020",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.\nleavers are teachers who left the teaching profession or the system and movers are those who move to another district.")


# teacher turnover rates by teacher of color
df_s275_turnover %>% 
  filter(schyear < 2021) %>%
  mutate(race_new = if_else(race == "B" & hispanic == "N", "Black",
                            if_else(hispanic == "Y", "Hispanic",
                                    if_else(race == "A" & hispanic == "N", "Asian",
                                            if_else(race == "W" & hispanic == "N", "White", "Other"))))
         ) %>% 
  filter(race_new != "Other") %>% 
  group_by(schyear, race_new) %>% 
  summarize(tch_leavers = mean(tch_turnover == "leave"),
            tch_movers = mean(tch_turnover == "diff_dist_tch")) %>% 
  ggplot(aes(x = schyear, color = race_new)) +
  geom_line(aes(y = tch_leavers, linetype = "Leavers")) +
  geom_point(aes(y = tch_leavers, color = race_new)) +
  ylim(0, 0.15) +
  geom_line(aes(y = tch_movers, linetype = "Movers")) + 
  geom_point(aes(y = tch_movers, color = race_new)) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_linetype_manual(values = c('Leavers' = 'solid', 'Movers' = 'dashed'), labs(color = 'Turnover type')) +
  labs(x = "",
       y = "Turnover rate",
       color = "Teacher race",
       title = "Average teacher turnover rate by teachers race in WA state\nbetween AY 2015-2016 to 2019-2020",
       caption = "leavers are teachers who left the teaching profession or the system and movers are those who move to another district.")





# teacher newcomers
df_s275_turnover %>% 
  filter(dist_nonwhite_cat %in% c("0 to 25%", "76 to 100%") & schyear > 2016 & schyear <= 2021) %>%
  group_by(schyear, dist_nonwhite_cat) %>% 
  summarize(tch_newcomer = mean(tch_newcomer1 == 1)) %>% 
  ggplot(aes(x = schyear, y = tch_newcomer, color = dist_nonwhite_cat)) +
  geom_line() +
  geom_point() +
  ylim(0, .2) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_linetype_manual(values = c('Leavers' = 'solid', 'Movers' = 'dashed'), labs(color = 'Turnover type')) +
  # scale_x_continuous(breaks = c(2017, 2018, 2019)) +
labs(x = "",
     y = "newcomers rate",
     color = "Share of students\nof color",
     title = "Average teacher newcomers rate by high vs. low students of color in WA state\nbetween AY 2016-2017 to 2020-2021",
     caption = "In all estimates, asians are excluded from non-white or people of color categories.\nnewcomer is defined as a teacher who was not present in the system in the prior year.")


df_s275_turnover %>% 
  filter(dist_poverty_cat %in% c("0 to 25%", "76 to 100%") & schyear > 2016 & schyear <= 2021) %>%
  group_by(schyear, dist_poverty_cat) %>% 
  summarize(tch_newcomer = mean(tch_newcomer1 == 1)) %>% 
  ggplot(aes(x = schyear, y = tch_newcomer, color = dist_poverty_cat)) +
  geom_line() +
  geom_point() +
  ylim(0, .15) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_linetype_manual(values = c('Leavers' = 'solid', 'Movers' = 'dashed'), labs(color = 'Turnover type')) +
  # scale_x_continuous(breaks = c(2017, 2018, 2019)) +
  labs(x = "",
       y = "newcomers rate",
       color = "Share of students\nreceiving FRPL",
       title = "Average teacher newcomers rate by high vs. low poverty in WA state\nbetween AY 2016-2017 to 2020-2021",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.\nnewcomer is defined as a teacher who was not present in the system in the prior year.")





# teacher newcomers (to districts)
df_s275_turnover %>% 
  filter(dist_nonwhite_cat %in% c("0 to 25%", "76 to 100%") & schyear > 2016 & schyear <= 2021) %>%
  group_by(schyear, dist_nonwhite_cat) %>% 
  summarize(tch_newcomer = mean(tch_newcomer2 == 1)) %>% 
  ggplot(aes(x = schyear, y = tch_newcomer, color = dist_nonwhite_cat)) +
  geom_line() +
  geom_point() +
  ylim(0, .2) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_x_continuous(breaks = c(2017, 2018, 2019, 2020, 2021)) +
  labs(x = "",
       y = "newcomers rate",
       color = "Share of students\nof color",
       title = "Average teacher newcomers rate by high vs. low students of color in WA state\nbetween AY 2016-2017 to 2020-2021",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.\nnewcomer is defined as a teacher who was not present in his/her current school district in the prior year.")


df_s275_turnover %>% 
  filter(dist_poverty_cat %in% c("0 to 25%", "76 to 100%") & schyear > 2016) %>%
  group_by(schyear, dist_poverty_cat) %>% 
  summarize(tch_newcomer = mean(tch_newcomer2 == 1)) %>% 
  ggplot(aes(x = schyear, y = tch_newcomer, color = dist_poverty_cat)) +
  geom_line() +
  geom_point() +
  ylim(0, .2) +
  theme_bw() +
  theme(plot.caption = element_text(hjust = 0, face= "italic")) +
  scale_x_continuous(breaks = c(2017, 2018, 2019, 2020, 2021)) +
  labs(x = "",
       y = "newcomers rate",
       color = "Share of students\nreceiving FRPL",
       title = "Average teacher newcomers rate by high vs. low poverty in WA state\nbetween AY 2016-2017 to 2020-2021",
       caption = "In all estimates, asians are excluded from non-white or people of color categories.\nnewcomer is defined as a teacher who was not present in his/her current school district in the prior year.")





```
